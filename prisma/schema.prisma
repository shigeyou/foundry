generator client {
  provider        = "prisma-client-js"
  output          = "../src/generated/prisma"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model CoreService {
  id          String   @id @default(cuid())
  name        String
  category    String?
  description String?
  url         String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model CoreAsset {
  id          String   @id @default(cuid())
  name        String
  type        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Constraint {
  id          String   @id @default(cuid())
  name        String
  description String?
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())
}

model Exploration {
  id          String   @id @default(cuid())
  question    String
  context     String?
  constraints String
  status      String   @default("completed")
  result      String?
  error       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model RAGDocument {
  id        String   @id @default(cuid())
  filename  String
  fileType  String
  content   String
  metadata  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ScoreBaseline {
  id              String   @id @default(cuid())
  date            DateTime @default(now())
  runId           String?
  topScore        Float
  avgScore        Float
  totalStrategies Int
  highScoreCount  Int
  improvement     Float?
  createdAt       DateTime @default(now())
}

model TopStrategy {
  id                String   @id @default(cuid())
  explorationId     String
  name              String
  reason            String
  howToObtain       String?
  totalScore        Float
  scores            String
  question          String
  judgment          String
  learningExtracted Boolean  @default(false)
  createdAt         DateTime @default(now())

  @@index([totalScore])
  @@index([learningExtracted])
}

model AutoExploreRun {
  id                    String    @id @default(cuid())
  status                String    @default("running")
  triggerType           String    @default("manual")
  questionsGenerated    Int       @default(0)
  explorationsCompleted Int       @default(0)
  highScoresFound       Int       @default(0)
  topScore              Float?
  topStrategyName       String?
  baselineScore         Float?
  achievedScore         Float?
  improvement           Float?
  startedAt             DateTime  @default(now())
  completedAt           DateTime?
  duration              Int?
  errors                String?
}

model LearningMemory {
  id              String    @id @default(cuid())
  type            String
  category        String?
  pattern         String
  examples        String
  evidence        String?
  confidence      Float     @default(0.5)
  validationCount Int       @default(0)
  successRate     Float?
  usedCount       Int       @default(0)
  lastUsedAt      DateTime?
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([type])
  @@index([isActive])
  @@index([confidence])
}

model StrategyDecision {
  id              String   @id @default(cuid())
  explorationId   String
  strategyName    String
  decision        String
  reason          String?
  feasibilityNote String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([explorationId, strategyName])
  @@index([decision])
  @@index([createdAt])
}

model DefaultSwot {
  id            String   @id @default("default")
  strengths     String
  weaknesses    String
  opportunities String
  threats       String
  summary       String?
  updatedAt     DateTime @updatedAt
  updatedBy     String?
}

model MetaAnalysisRun {
  id                String   @id @default(cuid())
  totalExplorations Int
  totalStrategies   Int
  topStrategies     String   // JSON array
  frequentTags      String   // JSON array
  clusters          String   // JSON array
  blindSpots        String   // JSON array
  thinkingProcess   String
  createdAt         DateTime @default(now())
}
